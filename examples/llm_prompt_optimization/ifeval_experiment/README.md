# IFEval Prompt Evolution Experiment

–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç –ø–æ —ç–≤–æ–ª—é—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è **IFEval** (Instruction Following Evaluation) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OpenEvolve. –¶–µ–ª—å ‚Äî –Ω–∞–π—Ç–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å–æ–±–ª—é–¥–∞—é—Ç —Å–ª–æ–∂–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π.

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

```
ifeval_experiment/
‚îú‚îÄ‚îÄ ifeval_prompt.txt               # –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
‚îú‚îÄ‚îÄ ifeval_prompt_dataset.yaml      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞ google/IFEval
‚îú‚îÄ‚îÄ config.yaml                     # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ OpenEvolve
‚îú‚îÄ‚îÄ evaluator.py                    # –û—Ü–µ–Ω–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ
‚îú‚îÄ‚îÄ run_evolution.ps1               # –ó–∞–ø—É—Å–∫ —ç–≤–æ–ª—é—Ü–∏–∏ (PowerShell)
‚îú‚îÄ‚îÄ visualize_evolution.py          # –ì—Ä–∞—Ñ–∏–∫–∏ –∏ –æ—Ç—á—ë—Ç—ã
‚îú‚îÄ‚îÄ analyze_improvements.py         # Markdown-–æ—Ç—á—ë—Ç—ã –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º
‚îú‚îÄ‚îÄ templates/                      # –®–∞–±–ª–æ–Ω—ã —Å–∏—Å—Ç–µ–º–Ω—ã—Ö/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–º–ø—Ç–æ–≤
‚îú‚îÄ‚îÄ PROMPT_COMPONENTS_EXPLANATION.md
‚îú‚îÄ‚îÄ IFEVAL_DATASET_INFO.md
‚îî‚îÄ‚îÄ README.md
```

## üß† –ß—Ç–æ —Ç–∞–∫–æ–µ IFEval

- **–ó–∞–¥–∞—á–∞**: –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–æ–∂–Ω—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, —Å–æ–¥–µ—Ä–∂–∞—â—É—é –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –∑–∞–ø—Ä–µ—Ç—ã, –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –∏ —Ç.–¥.).
- **–†–∞–∑–º–µ—Ä**: 541 –ø—Ä–∏–º–µ—Ä–æ–≤ (train split).
- **–ú–µ—Ç—Ä–∏–∫–∞**: –Ω–∞—Å–∫–æ–ª—å–∫–æ –æ—Ç–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤—Å–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
- –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–∞—Ç–∞—Å–µ—Ç–∞ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—è—Ö —Å–º. `IFEVAL_DATASET_INFO.md`.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```powershell
pip install openevolve datasets openai tqdm pyyaml matplotlib jsonlines
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API-–∫–ª—é—á
```powershell
$env:OPENAI_API_KEY = "your_openrouter_api_key"
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç–≤–æ–ª—é—Ü–∏—é
```powershell
.\run_evolution.ps1 --iterations 100
```

### 4. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –æ—Ç—á—ë—Ç—ã –∏ –≥—Ä–∞—Ñ–∏–∫–∏
```powershell
python visualize_evolution.py
```

### 5. –°—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ Markdown-–æ—Ç—á—ë—Ç –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º
```powershell
.\analyze_improvements.ps1
```

## üì¶ –ß—Ç–æ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ `openevolve_output/`

| –ü—É—Ç—å | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ |
|------|------------|
| `best/` | –ª—É—á—à–∏–π –ø—Ä–æ–º–ø—Ç –∏ –µ–≥–æ –º–µ—Ç—Ä–∏–∫–∏ |
| `checkpoints/` | –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –∫–∞–∂–¥—ã–µ 10 –∏—Ç–µ—Ä–∞—Ü–∏–π |
| `evolution_trace.jsonl` | –ø–æ–ª–Ω—ã–π –ª–æ–≥ –≤—Å–µ—Ö —à–∞–≥–æ–≤ —ç–≤–æ–ª—é—Ü–∏–∏ |
| `logs/` | –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞ OpenEvolve |
| `visualizations/learning_curve.png` | –æ–±—É—á–µ–Ω–∏–µ (best vs average) |
| `visualizations/metrics_evolution.png` | –ø–ª–∞–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ –º–µ—Ç—Ä–∏–∫ |
| `visualizations/evolution_report.txt` | —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç |
| `visualizations/improvements_analysis.md` | Markdown-–æ—Ç—á—ë—Ç –ø–æ —É–ª—É—á—à–µ–Ω–∏—è–º |
| `visualizations/improvements/` | –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ø–æ –∫–∞–∂–¥–æ–º—É –∑–∞–º–µ—Ç–Ω–æ–º—É —É–ª—É—á—à–µ–Ω–∏—é |

## üîç Evolution Trace (jsonl)

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ä–æ–¥–∏—Ç–µ–ª—è/–ø–æ—Ç–æ–º–∫–∞ –∏ –∏—Ö –º–µ—Ç—Ä–∏–∫–∏ (`combined_score`, `prompt_length`, `reasoning_strategy`);
- –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–æ/–ø–æ—Å–ª–µ;
- –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω `full_rewrite_user.txt` (system –∏ user —á–∞—Å—Ç–∏);
- –æ—Ç–≤–µ—Ç LLM;
- `improvement_delta` –∏ –¥–æ–ø. –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—É—Ç—å —ç–≤–æ–ª—é—Ü–∏–∏;
- –∏—Å–∫–∞—Ç—å, –∫–∞–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–ª–∏ —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π –ø—Ä–∏—Ä–æ—Å—Ç;
- –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã.

## ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (`config.yaml`)

- `max_iterations: 100`, `checkpoint_interval: 10`
- 4 –æ—Å—Ç—Ä–æ–≤–∞ MAP-Elites (`database.num_islands: 4`)
- –ü—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è —Å–µ—Ç–∫–∏: `prompt_length`, `reasoning_strategy`
- –í–∫–ª—é—á—ë–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π trace (`evolution_trace.enabled: true`)
- –ö–∞—Å–∫–∞–¥–Ω–∞—è –æ—Ü–µ–Ω–∫–∞: Stage1 (10 –ø—Ä–∏–º–µ—Ä–æ–≤) ‚Üí Stage2 (40 –ø—Ä–∏–º–µ—Ä–æ–≤)
- LLM feedback –≤–µ—Å–æ–º 0.2, —á—Ç–æ–±—ã –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —ç–≤–æ–ª—é—Ü–∏—é –ø–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º:
  - clarity, specificity, robustness, format specification

## üß™ –ö–∞–∫ –æ—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ IFEval

1. `evaluator.py` –∑–∞–≥—Ä—É–∂–∞–µ—Ç `google/IFEval` (train split).
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è `{instruction}`.
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, —á—Ç–æ –æ—Ç–≤–µ—Ç –Ω–µ –ø—É—Å—Ç–æ–π –∏ –≤—ã–≥–ª—è–¥–∏—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–º (–±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
4. –°—á–∏—Ç–∞–µ—Ç—Å—è –¥–æ–ª—è ¬´—É—Å–ø–µ—à–Ω—ã—Ö¬ª –æ—Ç–≤–µ—Ç–æ–≤ ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å `combined_score`.
5. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è `prompt_length` –∏ `reasoning_strategy` –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è MAP-Elites.

> –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π IFEval (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ü–µ–ª–µ–π –ø–æ `instruction_id_list`), –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å `evaluate_prompt` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–∂–µ –æ—Ç–¥–µ–ª–µ–Ω–∞ –¥–ª—è —ç—Ç–æ–≥–æ.

## üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞

–ü–æ—Å–ª–µ `python visualize_evolution.py` –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

- `learning_curve.png`: –∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π best score (–∑–µ–ª—ë–Ω–∞—è –ª–∏–Ω–∏—è), —Å—Ä–µ–¥–Ω–∏–π score (—Å–∏–Ω—è—è –ø—É–Ω–∫—Ç–∏—Ä–Ω–∞—è), –∫—Ä–∞—Å–Ω—ã–µ –∑–≤—ë–∑–¥–æ—á–∫–∏ ‚Äî –Ω–æ–≤—ã–µ —Ä–µ–∫–æ—Ä–¥—ã.
- `metrics_evolution.png`: —Å–≥–ª–∞–∂–µ–Ω–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ `combined_score`, `prompt_length`, `reasoning_strategy`.
- `evolution_report.txt`: —Å–≤–æ–¥–∫–∞ (—à–∞–≥–∏, —Å—Ç–∞—Ä—Ç/—Ñ–∏–Ω–∏—à, –æ–±—â–∏–π –ø—Ä–∏—Ä–æ—Å—Ç, —Ç–æ–ø —É–ª—É—á—à–µ–Ω–∏–π, –ª—É—á—à–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã).

### –£–ª—É—á—à–µ–Ω–∏—è (Markdown)

`.\analyze_improvements.ps1` —Å–æ–∑–¥–∞—ë—Ç:
- `improvements_analysis.md` ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ –≤—Å–µ–º —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —É–ª—É—á—à–µ–Ω–∏—è–º;
- `visualizations/improvements/improvement_XX_iter_YYY.md` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ –º–µ—Ç—Ä–∏–∫ –∏ —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–æ/–ø–æ—Å–ª–µ;
- –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π system/user prompt (—Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º —à–∞–±–ª–æ–Ω–æ–º `full_rewrite_user.txt`) –∏ –æ—Ç–≤–µ—Ç LLM –±–µ–∑ –æ–±—Ä–µ–∑–∫–∏.

## üîÑ –¢–∏–ø–æ–≤–æ–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å API-–∫–ª—é—á.
2. **–ó–∞–ø—É—Å–∫ —ç–≤–æ–ª—é—Ü–∏–∏**: `.\run_evolution.ps1 --iterations 100`.
3. **–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏**: `python visualize_evolution.py`.
4. **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏—è**: `.\analyze_improvements.ps1`.
5. **–ò–∑—É—á–∏—Ç—å trace** (–ø–æ –∂–µ–ª–∞–Ω–∏—é): `openevolve_output/evolution_trace.jsonl`.

## üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

- **–ù–µ—Ç `evolution_trace.jsonl`** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `config.yaml` (—Å–µ–∫—Ü–∏—è `evolution_trace`) –∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∏—Å–∏ –≤ `openevolve_output/`.
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Å—Ç—Ä–æ–∏—Ç—Å—è** ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ trace —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –Ω–µ –ø—É—Å—Ç–æ–π; —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `matplotlib`.
- **API-–æ—à–∏–±–∫–∏** ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `OPENAI_API_KEY`, –±–∞–ª–∞–Ω—Å –∏ –ª–æ–≥–∏ –≤ `openevolve_output/logs/`.

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∞–π–ª—ã

- `PROMPT_COMPONENTS_EXPLANATION.md` ‚Äî –æ—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è –∫–∞–∂–¥–∞—è —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞, –∫–∞–∫ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è `key_features` –∏ —Ç.–¥.
- `IFEVAL_DATASET_INFO.md` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –Ω–∏–º, —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã.

## üì¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã:
1. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ (`openevolve_output/logs/`).
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ trace –∏ Markdown-–æ—Ç—á—ë—Ç—ã.
3. –°—Ä–∞–≤–Ω–∏—Ç–µ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –≤ `PROMPT_COMPONENTS_EXPLANATION.md`.

–£–¥–∞—á–Ω—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —Å IFEval! üöÄ

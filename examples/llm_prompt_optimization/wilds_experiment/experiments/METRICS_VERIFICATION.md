# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏: –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ú–æ–¥—É–ª—å –º–µ—Ç—Ä–∏–∫ (`metrics.py`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `compute_combined_score_unified()`
- ‚úÖ –°—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ DEPRECATED, –Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- ‚úÖ –§–æ—Ä–º—É–ª–∞: `0.4*R_global + 0.3*R_worst + 0.3*(1-MAE/4) + [0.1*max(0, kappa) –¥–ª—è ensemble]`

### 2. Evaluator Exp 2 (Single Model + Evolution)
- ‚úÖ **–ò–º–ø–æ—Ä—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ `compute_combined_score_unified`
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `compute_combined_score_unified(metrics, is_ensemble=False)`
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥**: –û–±–Ω–æ–≤–ª–µ–Ω `system_message` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º—É–ª—ã
- ‚úÖ **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: –£—á–∏—Ç—ã–≤–∞–µ—Ç R_global, R_worst, MAE

### 3. Evaluator Exp 3 (Ensemble + Evolution)
- ‚úÖ **–ò–º–ø–æ—Ä—Ç**: –û–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ `compute_combined_score_unified`
- ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: `compute_combined_score_unified(metrics, is_ensemble=True)`
- ‚úÖ **–ö–æ–Ω—Ñ–∏–≥**: –û–±–Ω–æ–≤–ª–µ–Ω `system_message` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º—É–ª—ã
- ‚úÖ **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**: –£—á–∏—Ç—ã–≤–∞–µ—Ç R_global, R_worst, MAE, mean_kappa (Cohen's Œ∫)

### 4. –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤ (`generate_final_report.py`)
- ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç combined_score –¥–ª—è –≤—Å–µ—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ —Å —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ñ–æ—Ä–º—É–ª–æ–π
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∏ –Ω–æ–≤–æ–π –º–µ—Ç—Ä–∏–∫–∏
- ‚úÖ –û–±—ä—è—Å–Ω—è–µ—Ç —Ñ–æ—Ä–º—É–ª—É –≤ —Ç–∞–±–ª–∏—Ü–µ

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

| –≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç | R_global | R_worst | MAE | Combined (Unified) | Old Combined | –†–∞–∑–Ω–∏—Ü–∞ |
|-------------|----------|---------|-----|-------------------|--------------|---------|
| Exp 1: Single Baseline | 50.19% | 30.77% | 0.721 | **0.539** | 0.484 | +11.4% |
| Exp 2: Single + Evolution | 58.67% | 35.74% | 0.539 | **0.601** | 0.571 | +5.3% |
| Exp 3a: Ensemble Baseline | 65.50% | 44.01% | 0.360 | **0.717** | 0.339 | +111.6% |
| Exp 3b: Ensemble + Evolution | 67.53% | 47.09% | 0.343 | **0.723** | 0.383 | +88.8% |

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—É–ª—ã

### Single Model (Exp 1, Exp 2)
**–§–æ—Ä–º—É–ª–∞**: `0.4 * R_global + 0.3 * R_worst + 0.3 * (1 - MAE/4)`

**Exp 1 –ø—Ä–∏–º–µ—Ä:**
- R_global = 0.5019 ‚Üí 0.4 * 0.5019 = 0.2008
- R_worst = 0.3077 ‚Üí 0.3 * 0.3077 = 0.0923
- MAE = 0.7209 ‚Üí 0.3 * (1 - 0.7209/4) = 0.3 * 0.8198 = 0.2459
- **Total = 0.5390** ‚úÖ

**Exp 2 –ø—Ä–∏–º–µ—Ä:**
- R_global = 0.5867 ‚Üí 0.4 * 0.5867 = 0.2347
- R_worst = 0.3574 ‚Üí 0.3 * 0.3574 = 0.1072
- MAE = 0.5387 ‚Üí 0.3 * (1 - 0.5387/4) = 0.3 * 0.8653 = 0.2596
- **Total = 0.6015** ‚úÖ

### Ensemble (Exp 3a, Exp 3b)
**–§–æ—Ä–º—É–ª–∞**: `base_score + 0.1 * max(0, mean_kappa)`

**Exp 3a –ø—Ä–∏–º–µ—Ä:**
- Base: 0.4 * 0.6550 + 0.3 * 0.4401 + 0.3 * (1 - 0.3598/4) = 0.6670
- Consistency: 0.1 * max(0, Œ∫) (Cohen's kappa)
- **Total = base + consistency** ‚úÖ

**Exp 3b –ø—Ä–∏–º–µ—Ä:**
- Base: 0.4 * 0.6753 + 0.3 * 0.4709 + 0.3 * (1 - 0.3432/4) = 0.6856
- Consistency: 0.1 * (1 - 0.6236) = 0.0376
- **Total = 0.7233** ‚úÖ

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤

### Exp 2 config.yaml
- ‚úÖ –û–±—ä—è—Å–Ω—è–µ—Ç R_global, R_worst, MAE
- ‚úÖ –§–æ—Ä–º—É–ª–∞: `0.4 * R_global + 0.3 * R_worst + 0.3 * (1 - MAE/4)`
- ‚úÖ –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç, —á—Ç–æ —Ñ–æ—Ä–º—É–ª–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å ensemble

### Exp 3 config.yaml
- ‚úÖ –û–±—ä—è—Å–Ω—è–µ—Ç R_global, R_worst, MAE, Disagreement Rate
- ‚úÖ –§–æ—Ä–º—É–ª–∞: `base_score + consistency_bonus`
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞ –≤–∫–ª—é—á–µ–Ω
- ‚úÖ –£–ø–æ–º–∏–Ω–∞–µ—Ç, —á—Ç–æ –±–∞–∑–æ–≤–∞—è —Ñ–æ—Ä–º—É–ª–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–∞ –¥–ª—è single –∏ ensemble

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ evaluators

### Exp 2 evaluator.py
```python
# –°—Ç—Ä–æ–∫–∞ 29: –ò–º–ø–æ—Ä—Ç
from experiments.metrics import compute_metrics, compute_combined_score_unified

# –°—Ç—Ä–æ–∫–∞ 345-346: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
val_metrics["combined_score"] = compute_combined_score_unified(val_metrics, is_ensemble=False)
train_metrics["combined_score"] = compute_combined_score_unified(train_metrics, is_ensemble=False)
```
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `is_ensemble=False` –¥–ª—è single model

### Exp 3 evaluator.py
```python
# –°—Ç—Ä–æ–∫–∞ 38: –ò–º–ø–æ—Ä—Ç
from experiments.metrics import compute_metrics, compute_combined_score_unified

# –°—Ç—Ä–æ–∫–∞ 380-381: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
val_metrics["combined_score"] = compute_combined_score_unified(val_metrics, is_ensemble=True)
train_metrics["combined_score"] = compute_combined_score_unified(train_metrics, is_ensemble=True)
```
‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `is_ensemble=True` –¥–ª—è ensemble

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è:
- ‚úÖ **R_global**: –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö evaluators (40% –≤–µ—Å)
- ‚úÖ **R_worst**: –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö evaluators (30% –≤–µ—Å)
- ‚úÖ **MAE**: –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤–æ –≤—Å–µ—Ö evaluators (30% –≤–µ—Å)
- ‚úÖ **Disagreement**: –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ ensemble (10% –±–æ–Ω—É—Å)

### –§–æ—Ä–º—É–ª–∞ –≤ —ç–≤–æ–ª—é—Ü–∏–∏:
- ‚úÖ OpenEvolve –ø–æ–ª—É—á–∞–µ—Ç `combined_score` –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ
- ‚úÖ –§–æ—Ä–º—É–ª–∞ –æ–±—ä—è—Å–Ω–µ–Ω–∞ –≤ `system_message` –∫–æ–Ω—Ñ–∏–≥–æ–≤
- ‚úÖ LLM –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –≤–∞–∂–Ω—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –°—Ä–∞–≤–Ω–∏–º–æ—Å—Ç—å:
- ‚úÖ Single model –∏ ensemble –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –±–∞–∑–æ–≤—É—é —Ñ–æ—Ä–º—É–ª—É
- ‚úÖ Ensemble –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–æ–Ω—É—Å –∑–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å
- ‚úÖ –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0.0, 1.0] (–¥–ª—è ensemble –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ 1.0)

## üìà –í—ã–≤–æ–¥—ã

1. **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –º–µ—Ç—Ä–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ** - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
2. **Evaluators –æ–±–Ω–æ–≤–ª–µ–Ω—ã** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
3. **–ö–æ–Ω—Ñ–∏–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã** - —Ñ–æ—Ä–º—É–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—ä—è—Å–Ω–µ–Ω–∞ –≤ system_message
4. **–û—Ç—á–µ—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã** - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –∏ –Ω–æ–≤–æ–π –º–µ—Ç—Ä–∏–∫–∏
5. **–°—Ä–∞–≤–Ω–∏–º–æ—Å—Ç—å –æ–±–µ—Å–ø–µ—á–µ–Ω–∞** - single model –∏ ensemble —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —ç–≤–æ–ª—é—Ü–∏—é —Å –Ω–æ–≤–æ–π –º–µ—Ç—Ä–∏–∫–æ–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
2. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unified –º–µ—Ç—Ä–∏–∫—É –¥–ª—è –≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
